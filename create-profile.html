<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Profile</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo">Digital Learning Nabha</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="signin.html">Sign In</a>
    </nav>
  </header>

  <div class="profile-container">
    <h2>Create Profile</h2>
    <form class="profile-form" id="profileForm">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" placeholder="Enter your full name" required>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" placeholder="Enter your email address" required>

      <label for="password">Password:</label>
      <input type="password" id="password" name="password" placeholder="Create a password (min 6 characters)" required>

      <label for="confirmPassword">Confirm Password:</label>
      <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password" required>

      <button type="submit" class="btn success" id="createBtn">Create Profile</button>

      <div id="messageContainer" class="message-container" style="margin-top: 20px; display: none;">
        <div id="message" class="message"></div>
      </div>
    </form>

    <p style="margin-top: 20px; text-align: center;">
      Already have an account? <a href="signin.html">Sign In</a>
    </p>
  </div>

  <script src="api-client.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const createBtn = document.getElementById('createBtn');
      const messageContainer = document.getElementById('messageContainer');
      const message = document.getElementById('message');

      function showMessage(text, type = 'error') {
        message.textContent = text;
        message.className = `message ${type}`;
        messageContainer.style.display = 'block';
        messageContainer.className = `message-container ${type}`;

        // Auto-hide success messages after 3 seconds
        if (type === 'success') {
          setTimeout(() => {
            hideMessage();
          }, 3000);
        }
      }

      function hideMessage() {
        messageContainer.style.display = 'none';
      }

      function setLoadingState(loading) {
        if (loading) {
          createBtn.disabled = true;
          createBtn.innerHTML = 'Creating Profile...';
          createBtn.classList.add('loading');
        } else {
          createBtn.disabled = false;
          createBtn.innerHTML = 'Create Profile';
          createBtn.classList.remove('loading');
        }
      }

      document.getElementById('profileForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        hideMessage();

        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // Validate inputs
        if (!name) {
          showMessage('Please enter your full name.');
          document.getElementById('name').focus();
          return;
        }

        if (!email) {
          showMessage('Please enter your email address.');
          document.getElementById('email').focus();
          return;
        }

        // Basic email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showMessage('Please enter a valid email address.');
          document.getElementById('email').focus();
          return;
        }

        if (!password) {
          showMessage('Please enter a password.');
          document.getElementById('password').focus();
          return;
        }

        if (password.length < 6) {
          showMessage('Password must be at least 6 characters long.');
          document.getElementById('password').focus();
          return;
        }

        if (password !== confirmPassword) {
          showMessage('Passwords do not match.');
          document.getElementById('confirmPassword').focus();
          return;
        }

        setLoadingState(true);

        try {
          const response = await apiClient.register({ name, email, password });

          if (response.token) {
            showMessage('Profile created successfully! Redirecting to home page...', 'success');

            // Store user data
            localStorage.setItem('user', JSON.stringify(response.user));

            // Redirect after showing success message
            setTimeout(() => {
              window.location.href = 'index.html';
            }, 2000);
          }
        } catch (error) {
          setLoadingState(false);
          showMessage(error.message || 'Failed to create profile. Please try again.');
        }
      });

      // Clear messages when user starts typing
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', hideMessage);
      });
    });
  </script>
</body>
</html>
